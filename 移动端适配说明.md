# 移动端适配说明

## 概述

项目已针对手机浏览器进行了全面优化，确保在移动设备上获得良好的游戏体验。

## 已实现的适配功能

### 1. Viewport 优化
- ✅ 禁用双击缩放：`user-scalable=no`
- ✅ 禁用最大缩放：`maximum-scale=1.0`
- ✅ 安全区域适配：`viewport-fit=cover`（适配刘海屏等）
- ✅ 禁用电话号码自动识别：`format-detection=telephone=no`

### 2. 触摸交互优化
- ✅ 禁用长按菜单：`-webkit-touch-callout: none`
- ✅ 禁用文本选择：`user-select: none`
- ✅ 优化触摸响应：`touch-action: manipulation`
- ✅ 移除点击高亮：`-webkit-tap-highlight-color: transparent`
- ✅ 禁用双击缩放事件处理

### 3. 屏幕适配
- ✅ **强制横屏模式**：移动端仅支持横屏显示
- ✅ 竖屏提示界面：检测到竖屏时显示旋转提示
- ✅ Phaser 自动缩放：使用 `FIT` 模式保持宽高比
- ✅ 自动居中：`CENTER_BOTH`
- ✅ 横竖屏切换处理：仅在横屏时刷新画布尺寸
- ✅ 窗口大小变化处理：适配移动端浏览器工具栏显示/隐藏

### 4. 性能优化
- ✅ 移动端关闭抗锯齿：`antialias: false`
- ✅ 响应式调整间隔：`resizeInterval: 500`
- ✅ 移动端特定配置：根据设备类型应用不同设置

### 5. PWA 支持
- ✅ Apple 全屏模式：`apple-mobile-web-app-capable`
- ✅ 状态栏样式：`apple-mobile-web-app-status-bar-style`

## 技术细节

### Viewport Meta 标签
```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<!-- 强制横屏（部分浏览器支持） -->
<meta name="screen-orientation" content="landscape">
<meta name="x5-orientation" content="landscape">
<meta name="x5-fullscreen" content="true">
```

### CSS 优化
```css
body {
  -webkit-touch-callout: none;  /* 禁用长按菜单 */
  -webkit-user-select: none;    /* 禁用文本选择 */
  user-select: none;
  touch-action: manipulation;    /* 优化触摸响应 */
  padding: env(safe-area-inset-*); /* 安全区域适配 */
}

canvas {
  touch-action: none;           /* 禁用默认触摸行为 */
  -webkit-tap-highlight-color: transparent; /* 移除点击高亮 */
}
```

### Phaser 配置
```typescript
// 移动端检测
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// 移动端特定配置
scale: {
  mode: Phaser.Scale.FIT,
  autoCenter: Phaser.Scale.CENTER_BOTH,
  resizeInterval: 500  // 响应式调整间隔
}

// 性能优化
render: {
  antialias: false  // 移动端关闭抗锯齿
}
```

### 事件处理
- 双击缩放防护：300ms 内连续触摸事件会被阻止
- 长按菜单禁用：`contextmenu` 事件被阻止
- 屏幕方向检测：实时检测横竖屏状态
- 竖屏提示：检测到竖屏时显示旋转提示界面
- 横竖屏切换：仅在横屏时刷新 Phaser 画布尺寸
- 窗口大小变化：仅在横屏时适配浏览器工具栏显示/隐藏

### 强制横屏实现
- 方向锁定 Meta 标签：尝试锁定横屏方向（浏览器支持有限）
- JavaScript 方向检测：实时检测屏幕方向
- 竖屏提示界面：显示友好的旋转提示
- 游戏隐藏：竖屏时自动隐藏游戏界面

## 支持的设备

- ✅ iOS Safari（iPhone、iPad）
- ✅ Android Chrome
- ✅ 其他移动浏览器（基于 WebKit/Blink）

## 测试建议

### 1. 触摸交互测试
- [ ] 按钮点击响应正常
- [ ] 无意外缩放
- [ ] 无长按菜单弹出
- [ ] 无文本选择高亮

### 2. 屏幕适配测试
- [ ] 横屏显示正常
- [ ] 竖屏时显示旋转提示
- [ ] 从竖屏切换到横屏时游戏正常显示
- [ ] 不同屏幕尺寸适配正常
- [ ] 安全区域（刘海屏）适配正常

### 3. 性能测试
- [ ] 游戏运行流畅（60fps）
- [ ] 无卡顿现象
- [ ] 内存占用合理

### 4. 浏览器工具栏测试
- [ ] 工具栏显示/隐藏时游戏自动适配
- [ ] 画布尺寸正确刷新

## 已知限制

1. **强制横屏**：移动端仅支持横屏模式，竖屏时会显示提示界面
2. **屏幕尺寸**：游戏设计为 1280x720，在小屏设备上会按比例缩放
3. **触摸精度**：按钮已优化触摸区域，但极小屏幕可能需要进一步调整
4. **性能**：低端设备可能需要降低画质或帧率
5. **方向锁定**：部分浏览器可能不支持完全锁定屏幕方向，但会通过提示引导用户旋转

## 未来优化方向

- [ ] 根据屏幕尺寸动态调整 UI 元素大小
- [ ] 添加移动端专用控制方案
- [ ] 优化移动端资源加载策略
- [ ] 添加移动端性能监控

## 相关文件

- `src/index.html` - HTML 和 CSS 优化
- `src/main.ts` - Phaser 配置和移动端事件处理

