# 玩家名字数据库配置

## 📋 概述

玩家名字系统使用 Supabase 远端数据库存储，确保所有玩家名字唯一，不允许重名。

## 🗄️ 数据库表结构

需要在 Supabase 中创建 `player_names` 表。

### SQL 创建语句

在 Supabase Dashboard 的 SQL Editor 中执行：

```sql
-- 创建玩家名字表
CREATE TABLE player_names (
  id BIGSERIAL PRIMARY KEY,
  player_name TEXT NOT NULL UNIQUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- 创建索引（提高查询性能）
CREATE INDEX idx_player_name ON player_names(player_name);

-- 启用行级安全
ALTER TABLE player_names ENABLE ROW LEVEL SECURITY;

-- 允许公开访问（读取和插入）
CREATE POLICY "Allow public read" ON player_names 
  FOR SELECT USING (true);

CREATE POLICY "Allow public insert" ON player_names 
  FOR INSERT WITH CHECK (true);
```

## 🔧 配置说明

### 1. 表字段说明

- `id`: 主键，自增
- `player_name`: 玩家名字（唯一约束，不允许重复）
- `created_at`: 记录创建时间

### 2. 唯一约束

- `player_name` 字段设置了 `UNIQUE` 约束，数据库层面保证名字唯一性
- 如果尝试插入重复名字，数据库会返回错误

### 3. 索引说明

- `idx_player_name`: 用于快速查询名字是否存在

### 4. 安全策略

- 允许所有人读取（检查名字是否存在）
- 允许所有人插入（注册新名字）
- 不允许更新和删除（防止名字被恶意修改）

## 📊 功能说明

### 1. 名字检查流程

1. 玩家输入名字
2. 系统检查名字长度（2-8个字）
3. 如果配置了 Supabase，检查名字是否已存在
4. 如果名字已存在，提示用户并阻止保存
5. 如果名字可用，注册到数据库并保存到本地

### 2. 降级方案

如果 Supabase 未配置，系统会跳过名字检查，允许使用任何名字（但仅保存在本地）。

## ✅ 验证配置

1. 在 Supabase Dashboard 的 Table Editor 中查看 `player_names` 表
2. 运行游戏，尝试设置一个名字
3. 检查表中是否有新记录
4. 尝试使用相同的名字，应该被阻止

## 🔄 注意事项

1. **名字唯一性**：一旦名字被注册，其他玩家无法使用相同名字
2. **名字修改**：如果玩家修改名字，新名字也需要通过唯一性检查
3. **网络问题**：如果网络连接失败，系统会允许使用名字（避免阻止游戏）

