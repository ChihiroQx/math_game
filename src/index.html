<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <!-- å¼ºåˆ¶æ¨ªå±ï¼ˆéƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼‰ -->
    <meta name="screen-orientation" content="landscape">
    <meta name="x5-orientation" content="landscape">
    <meta name="x5-fullscreen" content="true">
    <title>æ•°å­¦ç«¥è¯å†’é™©</title>
    <style>
        /* Happy Cotton å­—ä½“å®šä¹‰ */
        @font-face {
            font-family: 'HappyCotton';
            src: url('./assets/font/happy_cotton.ttf') format('truetype'),
                 url('assets/font/happy_cotton.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap; /* ä¼˜åŒ–å­—ä½“åŠ è½½æ€§èƒ½ */
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'HappyCotton', 'Microsoft YaHei', Arial, sans-serif;
            /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
            -webkit-touch-callout: none; /* ç¦ç”¨é•¿æŒ‰èœå• */
            -webkit-user-select: none; /* ç¦ç”¨æ–‡æœ¬é€‰æ‹© */
            user-select: none;
            touch-action: manipulation; /* ä¼˜åŒ–è§¦æ‘¸å“åº” */
            /* ä½¿ç”¨å›ºå®šå®šä½ï¼Œç¡®ä¿å æ»¡æ•´ä¸ªå¯è§†åŒºåŸŸ */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            /* ä½¿ç”¨ CSS å˜é‡å­˜å‚¨åŠ¨æ€é«˜åº¦ */
            height: var(--vh, 100vh);
            /* å®‰å…¨åŒºåŸŸé€‚é…ï¼ˆåˆ˜æµ·å±ç­‰ï¼‰ */
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            /* é˜²æ­¢æ»šåŠ¨ */
            overflow: hidden;
        }
        
        html {
            /* é˜²æ­¢é¡µé¢æ»šåŠ¨ */
            overflow: hidden;
            height: 100%;
            /* ä½¿ç”¨ CSS å˜é‡å­˜å‚¨åŠ¨æ€é«˜åº¦ */
            height: var(--vh, 100vh);
        }
        
        #game-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            /* ä½¿ç”¨ CSS å˜é‡å­˜å‚¨åŠ¨æ€é«˜åº¦ */
            height: var(--vh, 100vh);
            /* ç¡®ä¿ä¸è¢«é®æŒ¡ */
            position: relative;
            z-index: 1;
        }
        
        canvas {
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
            touch-action: none; /* ç¦ç”¨é»˜è®¤è§¦æ‘¸è¡Œä¸º */
            -webkit-tap-highlight-color: transparent; /* ç§»é™¤ç‚¹å‡»é«˜äº® */
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            font-size: 24px;
            z-index: 1000;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ç§»åŠ¨ç«¯ç‰¹å®šæ ·å¼ */
        @media (max-width: 768px) {
            #loading {
                font-size: 18px;
            }
            
            .spinner {
                width: 30px;
                height: 30px;
            }
        }
        
        /* æ¨ªå±ä¼˜åŒ– */
        @media (orientation: landscape) and (max-height: 500px) {
            #game-container {
                height: var(--vh, 100vh);
            }
        }
        
        /* ç«–å±æç¤ºç•Œé¢ */
        #orientation-tip {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 10000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        #orientation-tip.show {
            display: flex;
        }
        
        #orientation-tip .icon {
            font-size: 80px;
            margin-bottom: 30px;
            animation: rotate 2s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(90deg); }
        }
        
        #orientation-tip .text {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            font-family: 'HappyCotton', 'Microsoft YaHei', Arial, sans-serif;
        }
        
        #orientation-tip .hint {
            font-size: 16px;
            opacity: 0.8;
            font-family: 'HappyCotton', 'Microsoft YaHei', Arial, sans-serif;
        }
        
        /* ç§»åŠ¨ç«¯ç«–å±æ—¶éšè—æ¸¸æˆ */
        @media (orientation: portrait) and (max-width: 768px) {
            #game-container {
                display: none !important;
            }
            
            #loading {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- ç«–å±æç¤º -->
    <div id="orientation-tip">
        <div class="icon">ğŸ“±</div>
        <div class="text">è¯·å°†è®¾å¤‡æ¨ªå±</div>
        <div class="hint">ä¸ºäº†è·å¾—æœ€ä½³æ¸¸æˆä½“éªŒï¼Œè¯·æ—‹è½¬æ‚¨çš„è®¾å¤‡è‡³æ¨ªå±æ¨¡å¼</div>
    </div>
    
    <div id="loading">
        <div class="spinner"></div>
        <div>æ¸¸æˆåŠ è½½ä¸­...</div>
    </div>
    <div id="game-container"></div>
    
    <script>
        // å…¨å±ç®¡ç†
        const FullscreenManager = {
            isSupported: function() {
                const doc = document;
                return !!(
                    doc.fullscreenEnabled ||
                    doc.webkitFullscreenEnabled ||
                    doc.mozFullScreenEnabled ||
                    doc.msFullscreenEnabled
                );
            },
            
            isFullscreen: function() {
                const doc = document;
                return !!(
                    doc.fullscreenElement ||
                    doc.webkitFullscreenElement ||
                    doc.mozFullScreenElement ||
                    doc.msFullscreenElement
                );
            },
            
            requestFullscreen: async function(element) {
                const target = element || document.documentElement;
                const doc = document;
                
                try {
                    if (target.requestFullscreen) {
                        await target.requestFullscreen();
                        return true;
                    }
                    if (target.webkitRequestFullscreen) {
                        target.webkitRequestFullscreen();
                        return true;
                    }
                    if (target.webkitRequestFullScreen) {
                        target.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
                        return true;
                    }
                    if (target.mozRequestFullScreen) {
                        target.mozRequestFullScreen();
                        return true;
                    }
                    if (target.msRequestFullscreen) {
                        target.msRequestFullscreen();
                        return true;
                    }
                } catch (error) {
                    console.warn('è¿›å…¥å…¨å±å¤±è´¥:', error);
                    return false;
                }
                return false;
            },
            
            exitFullscreen: async function() {
                const doc = document;
                try {
                    if (doc.exitFullscreen) {
                        await doc.exitFullscreen();
                        return true;
                    }
                    if (doc.webkitExitFullscreen) {
                        doc.webkitExitFullscreen();
                        return true;
                    }
                    if (doc.webkitCancelFullScreen) {
                        doc.webkitCancelFullScreen();
                        return true;
                    }
                    if (doc.mozCancelFullScreen) {
                        doc.mozCancelFullScreen();
                        return true;
                    }
                    if (doc.msExitFullscreen) {
                        doc.msExitFullscreen();
                        return true;
                    }
                } catch (error) {
                    console.warn('é€€å‡ºå…¨å±å¤±è´¥:', error);
                    return false;
                }
                return false;
            }
        };
        
        // è®¾ç½®åŠ¨æ€è§†å£é«˜åº¦ï¼ˆè§£å†³ç§»åŠ¨ç«¯æµè§ˆå™¨å·¥å…·æ é®æŒ¡é—®é¢˜ï¼‰
        function setViewportHeight() {
            // è·å–å®é™…å¯è§†åŒºåŸŸé«˜åº¦ï¼ˆä¸åŒ…æ‹¬æµè§ˆå™¨å·¥å…·æ ï¼‰
            const vh = window.innerHeight * 0.01;
            // è®¾ç½® CSS å˜é‡
            document.documentElement.style.setProperty('--vh', `${vh * 100}px`);
        }
        
        // æ£€æµ‹å±å¹•æ–¹å‘å¹¶æ˜¾ç¤º/éšè—æç¤º
        function checkOrientation() {
            // æ›´æ–°è§†å£é«˜åº¦
            setViewportHeight();
            
            const tip = document.getElementById('orientation-tip');
            const gameContainer = document.getElementById('game-container');
            const loading = document.getElementById('loading');
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (!isMobile) {
                // éç§»åŠ¨è®¾å¤‡ï¼Œå§‹ç»ˆæ˜¾ç¤ºæ¸¸æˆ
                if (tip) tip.classList.remove('show');
                return;
            }
            
            // ç§»åŠ¨è®¾å¤‡æ£€æµ‹æ–¹å‘
            const isPortrait = window.innerHeight > window.innerWidth;
            
            if (isPortrait) {
                // ç«–å±ï¼šæ˜¾ç¤ºæç¤ºï¼Œéšè—æ¸¸æˆ
                if (tip) tip.classList.add('show');
                if (gameContainer) gameContainer.style.display = 'none';
                if (loading) loading.style.display = 'none';
            } else {
                // æ¨ªå±ï¼šéšè—æç¤ºï¼Œæ˜¾ç¤ºæ¸¸æˆ
                if (tip) tip.classList.remove('show');
                if (gameContainer) gameContainer.style.display = 'flex';
            }
        }
        
        // å°è¯•è¿›å…¥å…¨å±ï¼ˆéœ€è¦ç”¨æˆ·æ‰‹åŠ¿è§¦å‘ï¼‰
        let hasTriedFullscreen = false;
        function tryFullscreen() {
            if (hasTriedFullscreen || !FullscreenManager.isSupported()) {
                return;
            }
            
            // ç§»åŠ¨ç«¯ï¼šåœ¨æ¨ªå±æ—¶å°è¯•å…¨å±
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                const isPortrait = window.innerHeight > window.innerWidth;
                if (isPortrait) {
                    return; // ç«–å±æ—¶ä¸å°è¯•å…¨å±
                }
            }
            
            hasTriedFullscreen = true;
            FullscreenManager.requestFullscreen().catch(() => {
                // å…¨å±å¤±è´¥ä¸å½±å“æ¸¸æˆ
            });
        }
        
        // åˆå§‹åŒ–è§†å£é«˜åº¦
        setViewportHeight();
        checkOrientation();
        
        // ç›‘å¬æ–¹å‘å˜åŒ–
        window.addEventListener('orientationchange', () => {
            // å»¶è¿Ÿæ‰§è¡Œï¼Œç­‰å¾…æµè§ˆå™¨å®Œæˆæ–¹å‘åˆ‡æ¢
            setTimeout(() => {
                setViewportHeight();
                checkOrientation();
                // æ–¹å‘å˜åŒ–åï¼Œå¦‚æœæ˜¯æ¨ªå±ä¸”æ”¯æŒå…¨å±ï¼Œå¯ä»¥æç¤ºç”¨æˆ·ç‚¹å‡»è¿›å…¥å…¨å±
                hasTriedFullscreen = false;
            }, 200);
        });
        
        // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ˆåŒ…æ‹¬æµè§ˆå™¨å·¥å…·æ æ˜¾ç¤º/éšè—ï¼‰
        window.addEventListener('resize', () => {
            setViewportHeight();
            setTimeout(checkOrientation, 100);
        });
        
        // ç›‘å¬è§†è§‰è§†å£å˜åŒ–ï¼ˆç§»åŠ¨ç«¯æµè§ˆå™¨å·¥å…·æ æ˜¾ç¤º/éšè—ï¼‰
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', () => {
                setViewportHeight();
                setTimeout(checkOrientation, 100);
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå†æ¬¡è®¾ç½®ï¼ˆç¡®ä¿æ­£ç¡®ï¼‰
        window.addEventListener('load', () => {
            setViewportHeight();
            checkOrientation();
        });
        
        // åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡äº¤äº’æ—¶å°è¯•å…¨å±ï¼ˆç§»åŠ¨ç«¯éœ€è¦ç”¨æˆ·æ‰‹åŠ¿ï¼‰
        document.addEventListener('click', tryFullscreen, { once: true });
        document.addEventListener('touchstart', tryFullscreen, { once: true });
        
        // ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–
        ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange'].forEach(event => {
            document.addEventListener(event, () => {
                // å…¨å±çŠ¶æ€å˜åŒ–æ—¶å¯ä»¥åšä¸€äº›å¤„ç†
                if (FullscreenManager.isFullscreen()) {
                    console.log('å·²è¿›å…¥å…¨å±æ¨¡å¼');
                } else {
                    console.log('å·²é€€å‡ºå…¨å±æ¨¡å¼');
                }
            });
        });
    </script>
</body>
</html>
